{
  "version": 3,
  "sources": ["../../../server/chat-plugins/tsuchinokoify.ts"],
  "sourcesContent": ["import {FS} from '../../lib';\r\ntype TsuchinokoConfig = Record<string, { oldAvatar: string | number, endTime: number }>;\r\n\r\nconst TSUCHINOKO_AVATAR = 'tsuchinoko';\r\nconst TRANSFORMATION_DURATION = 7 * 60 * 1000;\r\n\r\nexport const configs: TsuchinokoConfig = JSON.parse(\r\n\tFS('config/chat-plugins/tsuchinoko.json').readIfExistsSync() || \"{}\"\r\n);\r\n\r\nconst saveConfig = () => {\r\n\tFS('config/chat-plugins/tsuchinoko.json').writeUpdate(() => JSON.stringify(configs));\r\n};\r\n\r\nconst untransform = (user: string) => {\r\n\tconst userId = toID(user);\r\n\tconst targetUser = Users.get(userId);\r\n\tif (!targetUser) return;\r\n\tconst config = configs[targetUser.id];\r\n\tif (config) {\r\n\t\ttargetUser.avatar = config.oldAvatar;\r\n\t\tdelete configs[targetUser.id];\r\n\t\tsaveConfig();\r\n\t}\r\n};\r\n\r\nexport const commands: Chat.ChatCommands = {\r\n\tboil: 'tsuchinokoify',\r\n\ttsuchinokoify(target, room, user) {\r\n\t\tif (!user.can('globalban', null)) return this.errorReply('You toy with power that you do not understand.');\r\n\r\n\t\tconst targetUser = Users.get(target);\r\n\t\tif (!targetUser) return this.errorReply('A live subject is required.');\r\n\r\n\t\tconst now = Date.now();\r\n\t\tconst targetUserConfig = configs[targetUser.id];\r\n\t\tif (targetUserConfig) {\r\n\t\t\ttargetUser.avatar = targetUserConfig.oldAvatar;\r\n\t\t\tdelete configs[targetUser.id];\r\n\t\t\tsaveConfig();\r\n\t\t\treturn this.sendReply(`The curse you have placed on ${targetUser.name} has been lifted.`);\r\n\t\t} else {\r\n\t\t\tsetTimeout(() => {\r\n\t\t\t\tuntransform(targetUser.id);\r\n\t\t\t}, TRANSFORMATION_DURATION);\r\n\t\t\tconfigs[targetUser.id] = {\r\n\t\t\t\toldAvatar: targetUser.avatar,\r\n\t\t\t\tendTime: now + TRANSFORMATION_DURATION,\r\n\t\t\t};\r\n\t\t\ttargetUser.avatar = TSUCHINOKO_AVATAR;\r\n\t\t\tsaveConfig();\r\n\t\t\treturn this.sendReply(`You have placed a curse on ${targetUser.name}... shame on you!`);\r\n\t\t}\r\n\t},\r\n};\r\n\r\nexport const loginfilter: Chat.LoginFilter = user => {\r\n\tconst now = Date.now();\r\n\tconst config = configs[user.id];\r\n\tif (config && (now > config.endTime)) {\r\n\t\tuser.avatar = config.oldAvatar;\r\n\t\tdelete configs[user.id];\r\n\t\tsaveConfig();\r\n\t}\r\n};\r\n\r\nexport const chatfilter: Chat.ChatFilter = (message, user) => {\r\n\tconst config = configs[user.id];\r\n\tif (config && !['!', '/'].some((symbol) => message.startsWith(symbol))) {\r\n\t\tif (Math.random() > 0.5) {\r\n\t\t\treturn message + ' *squeak*';\r\n\t\t}\r\n\t}\r\n\treturn message;\r\n};\r\n"],
  "mappings": ";;;;;;;;;;;;;;;;;;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,iBAAiB;AAGjB,MAAM,oBAAoB;AAC1B,MAAM,0BAA0B,IAAI,KAAK;AAElC,MAAM,UAA4B,KAAK;AAAA,MAC7C,eAAG,qCAAqC,EAAE,iBAAiB,KAAK;AACjE;AAEA,MAAM,aAAa,MAAM;AACxB,qBAAG,qCAAqC,EAAE,YAAY,MAAM,KAAK,UAAU,OAAO,CAAC;AACpF;AAEA,MAAM,cAAc,CAAC,SAAiB;AACrC,QAAM,SAAS,KAAK,IAAI;AACxB,QAAM,aAAa,MAAM,IAAI,MAAM;AACnC,MAAI,CAAC;AAAY;AACjB,QAAM,SAAS,QAAQ,WAAW,EAAE;AACpC,MAAI,QAAQ;AACX,eAAW,SAAS,OAAO;AAC3B,WAAO,QAAQ,WAAW,EAAE;AAC5B,eAAW;AAAA,EACZ;AACD;AAEO,MAAM,WAA8B;AAAA,EAC1C,MAAM;AAAA,EACN,cAAc,QAAQ,MAAM,MAAM;AACjC,QAAI,CAAC,KAAK,IAAI,aAAa,IAAI;AAAG,aAAO,KAAK,WAAW,gDAAgD;AAEzG,UAAM,aAAa,MAAM,IAAI,MAAM;AACnC,QAAI,CAAC;AAAY,aAAO,KAAK,WAAW,6BAA6B;AAErE,UAAM,MAAM,KAAK,IAAI;AACrB,UAAM,mBAAmB,QAAQ,WAAW,EAAE;AAC9C,QAAI,kBAAkB;AACrB,iBAAW,SAAS,iBAAiB;AACrC,aAAO,QAAQ,WAAW,EAAE;AAC5B,iBAAW;AACX,aAAO,KAAK,UAAU,gCAAgC,WAAW,uBAAuB;AAAA,IACzF,OAAO;AACN,iBAAW,MAAM;AAChB,oBAAY,WAAW,EAAE;AAAA,MAC1B,GAAG,uBAAuB;AAC1B,cAAQ,WAAW,EAAE,IAAI;AAAA,QACxB,WAAW,WAAW;AAAA,QACtB,SAAS,MAAM;AAAA,MAChB;AACA,iBAAW,SAAS;AACpB,iBAAW;AACX,aAAO,KAAK,UAAU,8BAA8B,WAAW,uBAAuB;AAAA,IACvF;AAAA,EACD;AACD;AAEO,MAAM,cAAgC,UAAQ;AACpD,QAAM,MAAM,KAAK,IAAI;AACrB,QAAM,SAAS,QAAQ,KAAK,EAAE;AAC9B,MAAI,UAAW,MAAM,OAAO,SAAU;AACrC,SAAK,SAAS,OAAO;AACrB,WAAO,QAAQ,KAAK,EAAE;AACtB,eAAW;AAAA,EACZ;AACD;AAEO,MAAM,aAA8B,CAAC,SAAS,SAAS;AAC7D,QAAM,SAAS,QAAQ,KAAK,EAAE;AAC9B,MAAI,UAAU,CAAC,CAAC,KAAK,GAAG,EAAE,KAAK,CAAC,WAAW,QAAQ,WAAW,MAAM,CAAC,GAAG;AACvE,QAAI,KAAK,OAAO,IAAI,KAAK;AACxB,aAAO,UAAU;AAAA,IAClB;AAAA,EACD;AACA,SAAO;AACR;",
  "names": []
}
