{
  "version": 3,
  "sources": ["../../../server/chat-plugins/veteran-badges.ts"],
  "sourcesContent": ["import {Badge} from '../badges';\r\nimport {Badges} from './badges';\r\n\r\ninterface VeteranBadgeConfiguration {\r\n\tformatId: string;\r\n\tbadgeId: string;\r\n\tminimumElo: 1200;\r\n\tminimumBattles: number;\r\n\tminimumWinrate: number;\r\n\tbadge?: Badge;\r\n}\r\n\r\nlet veteranBadgeConfigurations: VeteranBadgeConfiguration[] = [\r\n\t{\r\n\t\tformatId: 'gen8cloveronlyou',\r\n\t\tbadgeId: 'ouveteran',\r\n\t\tminimumElo: 1200,\r\n\t\tminimumBattles: 100,\r\n\t\tminimumWinrate: 0.40,\r\n\t},\r\n\t{\r\n\t\tformatId: 'gen8cloveronlyuu',\r\n\t\tbadgeId: 'uuveteran',\r\n\t\tminimumElo: 1200,\r\n\t\tminimumBattles: 100,\r\n\t\tminimumWinrate: 0.40,\r\n\t},\r\n\t{\r\n\t\tformatId: 'gen8cloveronlyru',\r\n\t\tbadgeId: 'ruveteran',\r\n\t\tminimumElo: 1200,\r\n\t\tminimumBattles: 100,\r\n\t\tminimumWinrate: 0.40,\r\n\t},\r\n\t{\r\n\t\tformatId: 'gen8cloveronlynu',\r\n\t\tbadgeId: 'nuveteran',\r\n\t\tminimumElo: 1200,\r\n\t\tminimumBattles: 100,\r\n\t\tminimumWinrate: 0.40,\r\n\t},\r\n\t{\r\n\t\tformatId: 'gen8cloveronlyubers',\r\n\t\tbadgeId: 'ubersveteran',\r\n\t\tminimumElo: 1200,\r\n\t\tminimumBattles: 100,\r\n\t\tminimumWinrate: 0.40,\r\n\t},\r\n\t{\r\n\t\tformatId: 'gen8cloveronlylc',\r\n\t\tbadgeId: 'lcveteran',\r\n\t\tminimumElo: 1200,\r\n\t\tminimumBattles: 100,\r\n\t\tminimumWinrate: 0.40,\r\n\t},\r\n\t{\r\n\t\tformatId: 'gen8clovercaponlyou',\r\n\t\tbadgeId: 'capveteran',\r\n\t\tminimumElo: 1200,\r\n\t\tminimumBattles: 100,\r\n\t\tminimumWinrate: 0.40,\r\n\t},\r\n\t{\r\n\t\tformatId: 'gen8cloverblobboscaponlyou',\r\n\t\tbadgeId: 'cabveteran',\r\n\t\tminimumElo: 1200,\r\n\t\tminimumBattles: 100,\r\n\t\tminimumWinrate: 0.40,\r\n\t},\r\n\t{\r\n\t\tformatId: 'gen8wackonlyou',\r\n\t\tbadgeId: 'wackveteran',\r\n\t\tminimumElo: 1200,\r\n\t\tminimumBattles: 100,\r\n\t\tminimumWinrate: 0.40,\r\n\t},\r\n\t{\r\n\t\tformatId: 'gen8sandboxonlyou',\r\n\t\tbadgeId: 'sandboxveteran',\r\n\t\tminimumElo: 1200,\r\n\t\tminimumBattles: 100,\r\n\t\tminimumWinrate: 0.40,\r\n\t},\r\n];\r\n\r\nconst initializeVeteranBadges = async () => {\r\n\tif (!Config.usesqlitebadges) return;\r\n\tveteranBadgeConfigurations = await Promise.all(veteranBadgeConfigurations.map(async (veteranBadgeConfiguration) => {\r\n\t\tif (veteranBadgeConfiguration.badge) return veteranBadgeConfiguration;\r\n\r\n\t\ttry {\r\n\t\t\tconst badge = await Badges.getBadge(veteranBadgeConfiguration.badgeId);\r\n\t\t\treturn {\r\n\t\t\t\t...veteranBadgeConfiguration,\r\n\t\t\t\tbadge,\r\n\t\t\t};\r\n\t\t} catch (error) {}\r\n\r\n\t\treturn veteranBadgeConfiguration;\r\n\t}));\r\n};\r\n\r\nexport const loginfilter: Chat.LoginFilter = user => {\r\n\tvoid initializeVeteranBadges().then(() => {\r\n\t\tveteranBadgeConfigurations.forEach(({formatId, badgeId, minimumElo, minimumBattles, minimumWinrate, badge}) => {\r\n\t\t\tif (!badge) return;\r\n\t\t\tconst ladder = Ladders(toID(formatId));\r\n\t\t\tvoid ladder.getTopData().then((rows) => {\r\n\t\t\t\trows.forEach((row) => {\r\n\t\t\t\t\tconst rowUserId = toID(row[2]);\r\n\t\t\t\t\tif (rowUserId !== user.id) return;\r\n\t\t\t\t\tconst totalGames = row[3] + row[4] + row[5];\r\n\t\t\t\t\tconst winrate = row[3] / totalGames;\r\n\r\n\t\t\t\t\tif (totalGames < minimumBattles) return;\r\n\t\t\t\t\tif (winrate < minimumWinrate) return;\r\n\t\t\t\t\tif (row[1] < minimumElo) return;\r\n\t\t\t\t\tvoid Badges.addBadgeToUser(user.id, badgeId, user, true).catch(() => {});\r\n\t\t\t\t});\r\n\t\t\t}).catch(() => {});\r\n\t\t});\r\n\t}).catch(() => {});\r\n};\r\n"],
  "mappings": "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",
  "names": ["import_badges"]
}
